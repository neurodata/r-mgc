---
title: "MGC Statistic"
author: "Eric Bridgeford"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{MGC}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# MGC Statistic

In this notebook, we will discuss the basics of the `MGC` statistic in a real data context, and demonstrate some of the useful plots that users may want to visualize the results with.

## Simulated Data

Here, we Define $X \sim Unif(-1, 1)$, where $x \in \mathbb{R}^n$ is $n$ samples from $X$. We also have some other vector $y$ where $y = x\beta + \nu$, where $\nu$ is $n$ samples from $N \sim \mathcal{N}(0, \epsilon)$ of random noise. Using MGC, we expect to uncover a linear dependence of $y$ on $x$.

```{r, fig.width=5, fig.height=5}
library(mgc)
require(ggplot2)
require(latex2exp)

n = 50  # 50 samples
d = 1  # simple 1-d case
eps = 0.2  # magnitude of noise
x = runif(n, min=-1, max=1)  # X ~ Unif(-1, 1)

A=matrix(0,d,1)
for (i in (1:d)){
  A[i]=1/i
}

nu = eps*rnorm(n, mean=0, sd=1)  # nu \sim 
y = x%*%A + nu

dat = data.frame(x=x, y=y)

ggplot(dat, aes(x=x, y=y)) +
  geom_point() +
  xlab(TeX("$x$")) +
  ylab(TeX("$y = x + \\nu$")) +
  ggtitle(TeX("Linear Relationship of $x$ on $y$; $var(\\nu) = 0.2$"))
```

We construct naive distance matrices for $x$ and $y$:

```{r, fig.width=5, fig.height=5}
Xd = dist(x, diag=TRUE, upper=TRUE)
Yd = dist(y, diag=TRUE, upper=TRUE)
```

and finally, visualize the results of the `MGC` with 100 permutation replicates:

```{r, fig.width=6, fig.height=4}
set.seed(12345)
res <- mgc.test(Xd, Yd, rep=100)  # 100 permutations test
mgc.plot.plot_mgc(res$localCorr, title = TeX("Local $p$-values for Linear Dependence"), legend.name=TeX("$p$"))  # plot local p-values
print(res$optimalScale)
print(res$statMGC)
```

As we can see, the local correlation plot suggests a strongly linear relationship. This is because intuitively, having more and more neighbors will help in our identification of the linear relationship between $x$ and $y$, and as we can see in the local $p$-values plot, $k=n=50$ and $l=n=50$ (scale 2500) shows the best $p$.

## Real Data


In the below demo, we show the result of `MGC` to determine the relationship between the first (sepal length) and third (petal length) dimensions of the `iris` dataset:

```{r, fig.width=6, fig.height=4}
set.seed(12345)
res <- mgc.test(iris[,1], iris[,3], rep=100)  # note that we can pass our data or a custom distance matrix
mgc.plot.plot_mgc(res$localCorr, title="MGC Corr Map, Sepal Length and Petal Length",
    xlab="Sepal Length Neighbors", ylab="Petal Length Neighbors")
print(res$statMGC)
```

viewing the corr map above we see that the relationship betweel Sepal and Petal Length is somewhat linear.
